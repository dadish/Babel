$(document).ready(function(){function a(a,b){var c,d;if(j&&a.bind===j)return j.apply(a,h.call(arguments,1));if(!isFunction(a))throw new TypeError("Bind must be called on a function");return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));Ctor.prototype=a.prototype;var e=new Ctor;Ctor.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return isObject(f)?f:e}}function b(){return(new Date).getTime()}function c(a,c,d){var e,f,g,h,i,j=function(){var k=b()-h;c>k&&k>0?e=setTimeout(j,c-k):(e=null,d||(i=a.apply(g,f),e||(g=f=null)))};return function(){g=this,f=arguments,h=b();var k=d&&!e;return e||(e=setTimeout(j,c)),k&&(i=a.apply(g,f),g=f=null),i}}function d(b){this.language=b.language,this.$el=$(b.el),this._progress=null,this.$babelName=this.$("#Inputfield_babel_name_"+this.language.name),this.$babelParent=this.$("#Inputfield_babel_parent_"+this.language.name),this._status=$("<span></span>"),this.$('[for="Inputfield_babel_name_'+q.name+'"]').append(this._status),this._note=$('<p class="notes">'+this.$babelName.attr("data-note")+"</p>"),this._note.insertAfter(this.$babelName),this._note.hide(200),this.$el.on("pageSelected","#Inputfield_babel_object_"+q.name,a(this.onObjectChange,this)),this.$babelName.on("keyup",a(c(this.onNameChange,250),this)),this.$babelParent.on("pageSelected",a(this.onNameChange,this)),this.$(".PageListActionsBabel").on("click","li.PageListActionEdit a",function(a){a.preventDefault(),parent.$("body").trigger("babel:action:edit",$(a.target).attr("href"))}),this.$(".PageListActionsBabel").on("click","li.PageListActionView a",function(a){a.preventDefault(),parent.$("body").trigger("babel:action:view",$(a.target).attr("href"))}),this.$(".PageListActionsBabel").on("click","li.PageListActionUnlink a",a(this.unlinkObject,this))}for(var e=Array.prototype,f=Object.prototype,g=Function.prototype,h=(e.push,e.slice),i=(e.concat,f.toString),j=(f.hasOwnProperty,Array.isArray,Object.keys,g.bind),k=["Arguments","Function","String","Number","Date","RegExp"],l=0;l<k.length;l++){var m=k[l];window["is"+m]=function(a){return i.call(a)==="[object "+m+"]"}}"function"!=typeof/./&&(window.isFunction=function(a){return"function"==typeof a||!1});var n;if(n=config.ProcessBabelTranslate,n.ajaxUrl=config.urls.admin+"page/babel-translate/",n.ajaxNameExistsUrl=config.urls.admin+"page/add/exists",n.pageEditUrl=config.urls.admin+"page/edit/",n.batchForm=!!$('[data-babel-batch-form="1"]').length,n.translateForm=!!$('[data-babel-translate-form="1"]').length,d.prototype.$=function(a){return this.$el.find(a)},d.prototype.replaceDescription=function(a,b){var c,d,e;c=this.$("#"+a+" > .InputfieldContent > .description"),d=c.text();for(e in b)d=d.replace("{{"+e+"}}",'"'+b[e]+'"');c.text(d)},d.prototype.onObjectChange=function(b,c){this._progress||(this._progress=$('<li class="ProcessBabelTranslateProgress"><i class="icon fa fa-fw fa-spinner fa-spin"></i></li>'),this.$(".InputfieldContent .Inputfields").append(this._progress)),this._progress.fadeIn(),$.get(n.ajaxUrl,{action:"fieldObject",id:n.pageId,object:c.id,language:this.language.id},a(this.onDataRecieve,this)),this.updateBabelActions(c)},d.prototype.onDataRecieve=function(a){this._progress.fadeOut(0),a=$.parseJSON(a),"dependency"===a.follow&&(id=a.inputfieldId+"_"+this.language.name,this.replaceDescription(id,a.replace),this.$("#Inputfield_babel_hidden_"+this.language.name).val(a.hiddenValue).trigger("change"))},d.prototype.onNameChange=function(){function b(a){this._status.html(" "+a),$(a).hasClass("taken")?(this.$babelName.addClass("ui-state-error-text"),this._note.show(200)):(this.$babelName.removeClass("ui-state-error-text"),this._note.hide(200))}$.get(n.ajaxNameExistsUrl,{parent_id:this.$babelParent.val(),name:this.$babelName.val()},a(b,this))},d.prototype.unlinkObject=function(a){var b,c;a.preventDefault(),b=this.$("#Inputfield_babel_object_"+this.language.name),c=this.$("#wrap_Inputfield_babel_object_"+this.language.name+" .PageListRoot"),c.find("*").off(),c.remove(),b.off(),b.val(""),b.ProcessPageList(config.ProcessBabelTranslate.translateSelectSettings),b.trigger("pageSelected",{id:0})},n.translateForm){var o,p,q;o={};for(var l=0;l<n.languages.length;l++)q=n.languages[l],p="#Inputfield_babel_"+q.name,o[q.name]=new d({language:q,el:p})}d.prototype.updateBabelActions=function(a){var b;b=this.$(".PageListActionsBabel li.PageListActionEdit a"),b.attr("href",a.id?n.pageEditUrl+"?id="+a.id:"#"),b=b=this.$(".PageListActionsBabel li.PageListActionView a"),b.attr("href",a.id?a.url:"#")};var r={progressDiv:$(".ProcessBabelTranslateProgress"),contentDiv:$(".ProcessBabelTranslateContent"),filterForm:$("#Inputfield_ProcessBabelTranslateHeader"),bodyDiv:$(".ProcessBabelTranslateBody"),infoDiv:$(".ProcessBabelTranslateInfo"),onSelectChange:function(a){var b,c,d;b=this.filterForm.find('[name="filter"]').val(),from=this.filterForm.find('[name="from"]').val(),c=this.filterForm.find('[name="to"]').val(),d=this.filterForm.find('[name="limit"]').val(),this.requestData(n.ajaxUrl,{filter:b,from:from,to:c,limit:d,page:1})},requestData:function(b,c){function d(a){a=$.parseJSON(a),this.bodyDiv.empty().append(a.body),this.infoDiv.empty().append(a.info),this.contentDiv.animate({opacity:1},200),this.progressDiv.fadeOut(200)}this.contentDiv.animate({opacity:0},200),this.progressDiv.fadeIn(200),$.get(b,c,a(d,this))},onPageClick:function(a){var b,c;a.preventDefault(),b=$(a.target),c=b.attr("href"),this.requestData(c)},changeOther:function(a){var b,c;b=$(a.target),c=$(b.is("#Inputfield_from")?"#Inputfield_to":"#Inputfield_from");var d=b.val(),e=c.val();if(d==e&&""!=d)for(var f=c.find("option"),g=0;g<f.length;g++)if(e=$(f[g]).attr("value"),d!=e&&""!=e){c.val(e);break}},init:function(){this.filterForm.on("change","#Inputfield_from, #Inputfield_to",a(this.changeOther,this)),this.filterForm.on("change","select",a(this.onSelectChange,this)),this.infoDiv.on("click",".ProcessBabelPageLink",a(this.onPageClick,this)),this.requestData(window.location.href)}};n.batchForm&&r.init();var s;$(document).on("click",".PageListActionBabel",function(a){var b;s=$(this),s.is("a")||(s=s.find("a")),s.data("magnificPopup")||(a.preventDefault(),b=s.attr("href"),s.attr("href",b+"&modal=1"),s.magnificPopup({type:"iframe",callbacks:{close:function(){n.batchForm&&r.onSelectChange()}}}),s.trigger("click"))}),$(document.body).on("babel:action:edit babel:action:view",function(a,b){$.magnificPopup.instance.close(),window.location.assign(b)})});